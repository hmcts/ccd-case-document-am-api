language: java
jdk:
  - openjdk8

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/

before_install:
  - curl https://raw.githubusercontent.com/hmcts/reform-api-docs/master/bin/publish-swagger-group-docs.sh > publish-swagger-group-docs.sh

script:
  - "./gradlew dependencyCheckAnalyze || echo 'dependencyCheckAnalyze failed'"

after_success:
  - '[ "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_PULL_REQUEST" = "false" ] && sh ./publish-swagger-group-docs.sh v1 v2'

notifications:
  email: false
  slack:
    rooms:
      - secure: fb4k4FTS/hzm/BqQW/8lSOi/rZllceLBjVIydNKCRRy+NhsPjGQTklWvmGNHw7nD73x0zX67/9loaPGbmfAljOeiGr7ylqkgLk6T0Y8kFR7acfmyfQjOcB/nrGCBNAW5WvYPvH17ilzZWD440jYV45VrvTFX8hUTrd3gWq1469DgkARsLK1gL1uQOcMPzR5AtauLXowz4bx29pikSWDI3BpfH0k/tfmMhQSn+Ks6LPPKZrZuv69ZSpmaYSx3CpMb7B9Kk3GFygNdzW9ZJ+dyvk9tqr3i7iYUCSyV5L121I5vPy0bR1xHkAGA3sad6mFXJ0vFF5DEu69x2M/31QAQj/gfanPfkHXfOPv6Wvo2x9PGzgesxGSUEQ6o9CNkjC4/AFiBMfhOioZcrpmAFioE4AiBNeDXTwRg4WmtG1+ljC3AFioC4bd2xHGBCf9M1fTfzZO98opIFX5j237GWdBu1rphNJIdgpAEyMvAbdQN/0mYL9oPPlpTKeu1asYJQKp6ipUMGcWQr5dyOtoligkIE7OiMK2l8tfh6ssdrWf3lN70SPACoardQ7fCZTCCVDabrkyPT91ad58zhY6QmbDGjAzWg/1QvDZP5cilTdJune1msMUUj3ctrdOliwLfgN8UIzNOSBl05zFiWuruDS6XyQ49ttMqRq7PY1vP4KY/lUA=
    on_success: change
    on_failure: always
    on_pull_requests: true
    template:
      - "Repo: `%{repository_slug}`"
      - "Branch: `%{branch}`"
      - "Build Number: (<%{build_url}|#%{build_number}>), Commit: (<%{compare_url}|%{commit}>)"
      - "Build Result: *%{result}*"
      - "Execution time: *%{duration}*"
      - "Message: %{message}"